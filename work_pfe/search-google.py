import psycopg2
import datetime
import json
try:
    from googlesearch import search
except ImportError:
    print("No module named 'google' found")

# to search
query = "HÃ©bergement Web tunisie"
conn = psycopg2.connect(host="localhost",database="myproject", user="root", password="toor")
cur = conn.cursor()
for j in search(query, tld="com", num=10, stop=30, pause=2):
    ##Get the name of the website
    x="www" in j
    d="host" in j
    if(x==False):
        sitename=j.split('.')[0]
        x=len(sitename)
        sitename=sitename[8:x]
    else:
        sitename=j.split('.')[1]
    ##check the website is the DATABASE or not
    cur.execute("""SELECT * FROM concurrents""")
    rows = cur.fetchall()
    b=False
    for row in rows:
        if(row[1]==sitename):
            b=True
    if(b==True):
        print("old")
    else:
        date=datetime.datetime.today().strftime('%Y-%m-%d')
        reference=(sitename,j,date)
        ##Insert the WEBSITE in the DATABASE
        cur.execute("""INSERT INTO concurrents (name,url,date)
        VALUES (%s,%s,%s)""",reference)
        print("new")
        conn.commit()
        ## CReate the json
        jsond = {
          "name":sitename,
          "url": j,
          "date": date
        }
        jsondata = json.dumps(jsond)
        print(jsondata)



conn.close()
